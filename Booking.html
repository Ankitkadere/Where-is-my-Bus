<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ticket Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script src="Blocked.js"></script>
</head>
<style>
  .blur {
    filter: blur(10px);
  }
</style>

<body class="bg-gray-100  items-center justify-center">
  <!-- Header -->
  <header class="bg-[#1a62a3] pt-2 ">
    <div class="flex bottom-4 text-white items-center justify-between w-full px-4  space-x-2 ">
      <div id="mobile-menu-button" aria-label="Toggle menu"
        class="flex items-center gap-4 justify-between text-white hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
        <i class="fas fa-bars text-xl"></i>
        <a href="index.html" class="flex items-center ml-2">
          <h1 class="font-extrabold text-xl leading-none md:pt-3">
            Where is my Bus
          </h1>
        </a>
      </div>


      <div class="  text-left">
        <!-- Trigger -->
        <div id="menuAppDownload" onclick="toggleMenu()" class=" text-white p-2 rounded-full hover:bg-gray-200">
          <i class="fas fa-mobile-alt text-white text-xl"></i>
        </div>

        <!-- Menu -->
        <div id="menu" onclick="toggleMenu()"
          class="hidden absolute left-0 top-0 w-full h-full mt-2  bg-gray-10 border z-[150] justify-center rounded-lg shadow-lg">

          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
          <style>
            /* Custom animation for fade in/out */
            .fade-in {
              animation: fadeInScale 0.3s forwards;
            }

            .fade-out {
              animation: fadeOutScale 0.3s forwards;
            }

            @keyframes fadeInScale {
              0% {
                opacity: 0;
                transform: scale(0.95);
              }

              100% {
                opacity: 1;
                transform: scale(1);
              }
            }

            @keyframes fadeOutScale {
              0% {
                opacity: 1;
                transform: scale(1);
              }

              100% {
                opacity: 0;
                transform: scale(0.95);
              }
            }
          </style>

          <div class="block  fixed top-0 left-0  text-gray-700 hover:bg-gray-100">
            <button id="PWA"
              class="flex fixed  items-center w-full h-full  justify-center gap-2 bg-black text-white px-6 opacity-70  py-3  font-semibold hover:bg-gray-700 transition">
              <i id="pwaInstallBtn" class="fas fa-mobile-alt text-9xl">
                <p id="installStatusMsg" class="mt-2 text-base text-white"> Install Now</p>
              </i>

            </button>

          </div>

          <script>
            const pwaBtn = document.getElementById('pwaInstallBtn');
            const statusMsg = document.getElementById('installStatusMsg');
            let deferredPrompt = null;
            let appInstalled = false;

            // Disable button until PWA prompt is ready
            pwaBtn.disabled = true;

            // Listen for beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
              e.preventDefault(); // Prevent auto prompt
              deferredPrompt = e;
              pwaBtn.disabled = false;
              statusMsg.textContent = " Install Now";
            });

            // Handle button click
            pwaBtn.addEventListener('click', async () => {
              if (appInstalled) {
                statusMsg.textContent = " Already installed.";
                return;
              }


              if (!deferredPrompt) {
                statusMsg.textContent = "âš ï¸ Your Device Does Not Support App";
                toggleMenu();
                return;
              }

              // Show the PWA install prompt
              deferredPrompt.prompt();
              const choice = await deferredPrompt.userChoice;

              if (choice.outcome === 'accepted') {
                statusMsg.textContent = "ðŸŽ‰ App Installed Successfully!";
                appInstalled = true;
              } else {
                statusMsg.textContent = "âŒ Install Dismissed By User.";
              }

              deferredPrompt = null;
              pwaBtn.disabled = true;
            });

            // Listen for actual app installation
            window.addEventListener('appinstalled', () => {
              statusMsg.textContent = "ðŸŽ‰ App Installed Successfully!";
              appInstalled = true;
              pwaBtn.disabled = true;
            });
          </script>

          <a href="#" class="hidden  block px-4 py-2 text-gray-700 hover:bg-gray-100">
            <i class="fas fa-share mr-2"></i> Share
          </a>
        </div>
      </div>
    </div>
    <!-- Tabs -->
    <nav class="pt-4 flex border-b border-b-white/50 text-white text-lg font-bold">
      <a href="index.html" onclick="showTab('buses')" id="tab-buses"
        class="flex-1 text-center py-3 border-white select-none">
        Buses
      </a>

      <a href="Booking.html" onclick="showTab('booking')" id="tab-booking"
        class="flex-1  border-b-4 border-white text-center py-3 select-none">
        Booking
      </a>
    </nav>

    <!-- Script -->
    <script>
      function showTab(tab) {
        // hide all sections
        document.querySelectorAll('.tab-content').forEach(el => {
          el.classList.add('hidden');
        });

        // remove active style
        document.querySelectorAll('[id^="tab-"]').forEach(el => {
          el.classList.remove('border-b-4', 'border-white');
        });

        // show selected section
        document.getElementById(tab).classList.remove('hidden');

        // activate selected tab
        document.getElementById('tab-' + tab)
          .classList.add('border-b-4', 'border-white');
      }
    </script>

  </header>
  <!-- Mobile Side Navbar -->
  <div id="mobile-nav"
    class="bg-white z-[100]  fixed inset-y-0 left-0 w-80  shadow-lg transform -translate-x-full transition-transform duration-300 ease-in-out z-50 overflow-y-auto">
    <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
      <a href="index.html" class="flex items-center space-x-2 pt-2">
        <i class="fas fa-bus fa-3x text-[#1a62a3]  "></i>
        <h1 class="font-extrabold w-full pr-2 text-2xl leading-none">
          Where is my Bus
          <span class="font-normal text-gray-500 text-base sm:text-lg ">
            Google
          </span>
        </h1>
      </a>

      <button id="mobile-menu-close" aria-label="Close menu"
        class="text-gray-700 hover:text-gray-900 focus:outline-none">
      </button>
    </div>
    <div class="px-1 py-1 border-b border-gray-200">
      <div class="relative w-full">
        <input aria-label="Search for products"
          class="w-full  border border-gray-400 rounded-md py-2 pl-3 pr-10 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent"
          placeholder="Search For ..." type="search" />

        <span class="absolute inset-y-0 right-3 flex items-center text-gray-500">
          <i class="fas fa-search text-[#1a1a1a] text-lg"></i>
        </span>
      </div>
    </div>

    <nav class="bg-white flex flex-col">
      <!-- Top Section -->
      <div class="p-4">
        <!-- Title -->
        <div class="flex items-center justify-between font-semibold text-gray-800 mb-4 cursor-pointer">
          <span>SERVICES BY BUS</span>
          <i class="fas fa-chevron-down text-sm"></i>
        </div>

        <!-- Menu -->
        <ul class="space-y-2 text-sm">
          <li>
            <a href="index.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-home"></i> Home
            </a>
          </li>
          <li>
            <a href="Adminpenel.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-user-shield"></i> Booking
            </a>
          </li>
          <li>
            <a href="Userchat.html" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-tv"></i> Services
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-clock"></i> Change Time
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-trash"></i> Remove Something
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-map-marker-alt"></i> Add Location
            </a>
          </li>
          <li>
            <a href="#" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100">
              <i class="fas fa-bus"></i> Add Buses
            </a>
          </li>
        </ul>
      </div>

      <!-- Bottom Bar -->
      <div
        class="fixed bottom-0 left-0 w-full border-t bg-white p-4 flex items-center justify-between text-sm shadow-md z-50">

        <div onclick="window.location.href='Owner.html'" class="cursor-pointer">
          <div class="font-semibold">Whereis My Bus</div>
          <div class="text-xs text-gray-500">Whereismybus.com</div>
        </div>

        <button title="Profile" onclick="window.location.href='Orderlist.html'"
          class="text-gray-600 hover:text-blue-600 transition">
          <i class="fas fa-shopping-cart text-lg"></i>
        </button>
      </div>
    </nav>
  </div>
  <!-- Overlay -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-30 hidden z-[50]" aria-hidden="true"></div>

  <script>

    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenuClose = document.getElementById("mobile-menu-close");
    const mobileNav = document.getElementById("mobile-nav");


    function openMenu() {
      mobileNav.classList.remove("-translate-x-full");
      overlay.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }

    function closeMenu() {
      mobileNav.classList.add("-translate-x-full");
      overlay.classList.add("hidden");
      document.body.style.overflow = "";
    }

    mobileMenuButton.addEventListener("click", openMenu);
    mobileMenuClose.addEventListener("click", closeMenu);
    overlay.addEventListener("click", closeMenu);

    // Modal
    const openBtn = document.getElementById("openModalBtn");
    const closeBtn = document.getElementById("closeModalBtn");
    const closeBtnFooter = document.getElementById("closeModalBtnFooter");
    const modalOverlay = document.getElementById("modalOverlay");
    const modalBox = document.getElementById("modalBox");

    function openModal() {
      modalOverlay.classList.remove("opacity-0", "pointer-events-none");
      modalOverlay.classList.add("opacity-100");
      modalBox.classList.remove("opacity-0", "scale-95", "fade-out");
      modalBox.classList.add("fade-in");
    }

    function closeModal() {
      modalBox.classList.remove("fade-in");
      modalBox.classList.add("fade-out");
      modalOverlay.classList.remove("opacity-100");
      modalOverlay.classList.add("opacity-0");

      setTimeout(() => {
        modalOverlay.classList.add("pointer-events-none");
        modalBox.classList.remove("fade-out");
        modalBox.classList.add("opacity-0", "scale-95");
      }, 300);
    }

    openBtn.addEventListener("click", openModal);
    closeBtn.addEventListener("click", closeModal);
    closeBtnFooter.addEventListener("click", closeModal);
    modalOverlay.addEventListener("click", (e) => {
      if (e.target === modalOverlay) closeModal();
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !modalOverlay.classList.contains("pointer-events-none")) {
        closeModal();
      }
    });



    // Show modal
    function showModal() {
      modalOverlay.classList.remove("opacity-0", "pointer-events-none");
      modalBox.classList.remove("opacity-0", "scale-95");
      modalOverlay.classList.add("opacity-100");
      modalBox.classList.add("opacity-100", "scale-100");
    }

    // Search input
    const firstinput = document.getElementById("firstinput");
    const searchbtn = document.getElementById("searchbtn");

    window.addEventListener("load", () => {
      firstinput.focus();
      firstinput.select();
    });

    function redirectToCourse() {
      const value = firstinput.value.trim();
      if (value !== "") {
        window.location.href = `Courselist.html?search=${encodeURIComponent(value)}`;
      }
    }

    firstinput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        redirectToCourse();
      }
    });
    searchbtn.addEventListener("click", redirectToCourse);

    // Menu toggle
    function toggleMenu() {
      document.getElementById("menu").classList.toggle("hidden");
    }
    // Simulate progress (alternative random style)
    function simulateProgress(callback) {
      let progress = 0;
      const interval = setInterval(() => {
        if (progress >= 100) {
          clearInterval(interval);
          progress = 100;
          progressBar.style.width = "100%";
          progressText.innerText = "100%";
          statusText.innerText = "App Installed!";
          audio.play();
          setTimeout(() => (appDownload.style.display = "none"), 2000);
          callback();
        } else {
          progress += 5 + Math.random() * 10;
          if (progress > 100) progress = 100;
          progressBar.style.width = `${progress}%`;
          progressText.innerText = `${Math.floor(progress)}%`;
        }
      }, 200);
    }

  </script>
  <!-- Loader -->
  <div id="loader" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center z-50">
    <div class="w-12 h-12 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
  </div>

  <!-- Main Box (Dial Pad) -->
  <div id="mainBox" class="w-full mx-auto fixed bottom-0  overflow-hidden">

    <!-- Header -->
    <div class="p-4 text-center">
      <h1 class="text-lg font-bold">Ticket Checker</h1>
      <p class="text-xs text-gray-500">Enter Passcode or Mobile</p>
    </div>

    <div class="p-3  bg-white ">

      <!-- Input -->
      <input id="filterInput" type="text" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
        class="w-full bg-gray-100 rounded-lg p-3 text-center focus:outline-none text-lg font-bold mb-4 tracking-widest shadow-inner"
        readonly />

      <!-- Keypad -->
      <div class="grid grid-cols-3 gap-3 text-lg font-bold">
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">1</button>
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">2</button>
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">3</button>
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">4</button>
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">5</button>
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">6</button>
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">7</button>
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">8</button>
        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">9</button>

        <button id="clearBtn" class="bg-red-100 text-red-600 py-3 rounded-lg shadow active:scale-95">
          C
        </button>

        <button class="key bg-gray-100 py-3 rounded-lg shadow active:scale-95">0</button>

        <button id="deleteBtn" class="bg-yellow-100 text-yellow-700 py-3 rounded-lg shadow active:scale-95">
          âŒ«
        </button>
      </div>

      <!-- Check Button -->
      <button id="checkBtn"
        class="w-full mt-4 bg-[#1a62a3] text-white py-3 rounded-lg font-bold text-base shadow-lg transition">
        Check Ticket
      </button>

    </div>
  </div>


  <!-- Ticket Result -->
  <div id="result" class="hidden w-full "></div>

  <script>
    const API_URL =
      "https://script.google.com/macros/s/AKfycbzkdg6vHCPXYmo8LdLB6Bk6c6hWzqpGNiAzWHBORtIVntStTPPxOTHo3buy31fMhO1Z_g/exec";

    const input = document.getElementById("filterInput");
    const keys = document.querySelectorAll(".key");
    const clearBtn = document.getElementById("clearBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const checkBtn = document.getElementById("checkBtn");
    const loader = document.getElementById("loader");
    const result = document.getElementById("result");
    const mainBox = document.getElementById("mainBox");

    // Keypad input
    keys.forEach((btn) => {
      btn.addEventListener("click", () => {
        if (input.value.length < 15) {
          input.value += btn.textContent;
        }
      });
    });

    // Clear input
    clearBtn.addEventListener("click", () => {
      input.value = "";
    });

    // Delete last digit
    deleteBtn.addEventListener("click", () => {
      input.value = input.value.slice(0, -1);
    });

    // Check ticket
    checkBtn.addEventListener("click", (e) => {
      e.preventDefault();
      fetchData();
    });

    async function fetchData() {
      const value = input.value.trim();
      if (!value) {
        alert("Enter passcode or mobile number");
        return;
      }

      loader.classList.remove("hidden");

      try {
        const res = await fetch(API_URL);
        const json = await res.json();

        const data = Array.isArray(json) ? json : json.data;

        const match = data.find((row) => {
          const pass = String(row.Passcode || "").trim();
          const mobile = String(row.Usermobile || "").trim();
          return pass === value || mobile === value;
        });

        loader.classList.add("hidden");

        if (match) {
          showTicket(match);
        } else {
          alert("Ticket not found");
        }
      } catch (err) {
        loader.classList.add("hidden");
        alert("Error loading data");
        console.error(err);
      }
    }

    function showTicket(match) {
      mainBox.classList.add("hidden");
      result.innerHTML = `
 <div class="fixed inset-0 bg-black/50 flex items-center justify-center">
<div class="bg-white m-2 fixed top-0 rounded-md shadow-xl overflow-hidden">
  <!-- Header -->
  <div class="bg-green-700 flex text-white p-3 relative">
    <!-- Seat Badge -->
    <div class=" top-3 left-3 
            w-12 h-12 
            bg-white text-emerald-700 
            font-bold text-lg
            rounded-full shadow 
            flex items-center justify-center">
      ${match.Seat || "-"}
    </div>
    <div class="mx-2">
    <h2 class="text-lg font-bold">${match.TBName || "-"}</h2>
    <p class="text-sm  font-bold">${match.TBNumber || "-"}</p> 
    </div>
  </div>
  <!-- Route -->
  <div class="p-4 text-center border-b">
    <div class="flex justify-between text-xs text-gray-500 mb-1">
      <span>From</span>
      <span>To</span>
    </div>

    <div class=" font-bold flex items-center justify-between gap-2">
      <span>${match.TStart || "-"}</span>
      <i class="fas fa-arrow-right text-emerald-600"></i>
      <span>${match.TEnd || "-"}</span>
    </div>

  </div>

  <!-- Passenger Info -->
  <div class="p-4 grid grid-cols-2 gap-3 text-sm border-b">
    <div>
      <p class="text-gray-500">Passenger</p>
      <p class="font-semibold">
        ${match.Username || ""} ${match.Userlast || ""}
      </p>
    </div>
    <div>
      <p class="text-gray-500">Mobile</p>
      <p class="font-semibold">${match.Usermobile || "-"}</p>
    </div>
    <div>
      <p class="text-gray-500">Age</p>
      <p class="font-semibold">${match.Age || "-"}</p>
    </div>
    <div>
      <p class="text-gray-500">Gender</p>
      <p class="font-semibold">${match.Gender || "-"}</p>
    </div>
    <div>
      <p class="text-gray-500">Date</p>
      <p class="font-semibold">${match.Date || "-"}</p>
    </div>
    <div>
      <p class="text-gray-500">Time</p>
      <p class="font-semibold">${match.Time || "-"}</p>
    </div>
  </div>

  <div class="p-3 grid grid-cols-3 text-sm border-b divide-x">
    <div class="text-left">
      <p class="text-gray-500">Class</p>
      <p class="font-semibold">${match.Class || "-"}</p>
    </div>

    <div class="text-center px-2">
      <p class="text-gray-500">Child</p>
      <p class="font-semibold">${match.Child || "0"}</p>
    </div>

    <div class="text-right ">
      <p class="text-gray-500">Price</p>
      <p class="font-semibold">â‚¹${match.Price || "-"}</p>
    </div>
  </div>
  <!-- Passcode -->
  <div class="p-2 border-b flex items-center justify-between">

    <div id="qrcode" class="w-12 h-12"></div>

    <div class="text-right">
      <p class="text-gray-500 text-xs">Passcode</p>
      <p class="font-bold text-xl tracking-widest">
        ${match.Passcode || "-"}
      </p>
    </div>
  </div>
  <!-- Footer -->

</div>  
<button id="backBtn"
  class="fixed bottom-2 left-2 right-2 bg-[#1a62a3] text-white py-3 rounded-lg font-bold text-base shadow-lg transition">
  Check Another Ticket
</button>

</div>
`;

      result.classList.remove("hidden");

      // Generate QR
      const qrText = `
Passcode: ${match.Passcode}
Name: ${match.Username} ${match.Userlast}
Seat: ${match.Seat}
From: ${match.TStart}
To: ${match.TEnd}
      `;

      new QRCode(document.getElementById("qrcode"), {
        text: qrText,
        width: 120,
        height: 120,
      });

      // Back button
      document.getElementById("backBtn").onclick = () => {
        result.classList.add("hidden");
        mainBox.classList.remove("hidden");
        input.value = "";
      };
    }
  </script>
</body>

</html>