<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bus Seat Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-50 flex flex-col items-center justify-center  ">

    <!-- Bus Layout -->
    <div id="busLayout" class=" w-full mx-auto bg-gray-100 rounded-md shadow">
        <div class="flex justify-around items-center mb-4">
            <div class="bg-yellow-400 px-3 py-1 rounded text-sm font-semibold select-none">Gate</div>
            <div class="flex flex-col items-center">
                <div
                    class="w-12 h-12 bg-black text-white flex items-center justify-center rounded-full text-2xl select-none">
                    ðŸš¾</div>
                <div class="text-sm font-bold mt-1 select-none">Driver</div>
            </div>
        </div>
        <div id="seating" class="grid grid-cols-3 gap-x-4 gap-y-1"></div>
    </div>

    <!-- Booking Form -->
    <form id="bookingForm" class="hidden shadow-lg rounded-lg max-w-7xl w-full p-4 space-y-6 bg-white" novalidate>

        <h1 class="text-3xl font-semibold text-gray-800 text-center">
            Ticket Booking
        </h1>

        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <div class="hidden">
                <label for="date" class="block text-gray-700 font-semibold mb-2">Date</label>
                <input type="date" id="date" name="Date"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    required readonly />
            </div>

            <div class="hidden">
                <label for="time" class="block text-gray-700 font-semibold mb-2">Time</label>
                <input type="time" id="time" name="Time"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    required readonly />
            </div>

            <div class="hidden">
                <label for="seat" class="block text-gray-700 font-semibold mb-2">Seat</label>
                <input type="text" id="seat" name="Seat" placeholder="Enter seat number"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    required readonly autocomplete="on" />
            </div>

            <div class="hidden">
                <label for="passcode" class="block text-gray-700 font-semibold mb-2">Passcode</label>
                <input type="number" id="passcode" name="Passcode" placeholder="Enter passcode"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    required readonly autocomplete="on" />
            </div>

            <div>
                <label for="username" class="block text-gray-700 font-semibold mb-2">First Name</label>
                <input type="text" id="username" name="Username" placeholder="Enter your first name"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    required autocomplete="name" />
            </div>

            <div>
                <label for="userlast" class="block text-gray-700 font-semibold mb-2">Last Name</label>
                <input type="text" id="userlast" name="Userlast" placeholder="Enter your last name"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    autocomplete="family-name" />
            </div>
            <div>
                <label for="usermobile" class="block text-gray-700 font-semibold mb-2">Pessanger Mobile</label>
                <input type="tel" id="usermobile" name="Usermobile" placeholder="+1 234 567 8900"
                    pattern="^\+?[0-9\s\-]{7,15}$"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    required autocomplete="tel" />
            </div>

            <div class="hidden">
                <label for="tbname" class="block text-gray-700 font-semibold mb-2">Bus Number</label>
                <input type="text" id="tbnumber" name="TBNumber" placeholder="Enter TBName"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    required readonly />
            </div>
            <div class="hidden">
                <label for="tbname" class="block text-gray-700 font-semibold mb-2">Bus Name</label>
                <input type="text" id="tbname" name="TBName" placeholder="Enter TBName" required
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>



            <div>
                <label for="age" class="block text-gray-700 font-semibold mb-2">Age</label>
                <input type="number" id="age" name="Age" min="0" max="120" placeholder="Enter your age" required
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>

            <div>
                <label for="gender" class="block text-gray-700 font-semibold mb-2">Gender</label>
                <select id="gender" name="Gender" required
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="" disabled selected>Select gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                    <option value="Group">Prefer Not To Say</option>
                </select>
            </div>

            <div>
                <label for="child" class="block text-gray-700 font-semibold mb-2">Pessanger / Child</label>
                <select id="child" name="Child" required
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="" disabled selected>Select</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                </select>
            </div>

            <div class="hidden">
                <label for="tstart" class="block text-gray-700 font-semibold mb-2">TStart</label>
                <input type="text" id="Tstart" name="TStart" required
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>

            <div class="hidden">
                <label for="tend" class="block text-gray-700 font-semibold mb-2">TEnd</label>
                <input type="text" id="tend" name="TEnd" required
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>

            <div class="hidden">
                <label for="tstatus" class="block text-gray-700 font-semibold mb-2">TStatus</label>
                <select id="tstatus" name="TStatus" required
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="confirmed">Ticket Confirmed</option>
                    <option value="pending">Pending</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>

            <div>
                <label for="class" class="block text-gray-700 font-semibold mb-2">Prefer Class ( Not Chances )</label>
                <select id="class" name="Class"
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="Normal" disabled selected>Select class (Not Chances)</option>
                    <option value="Sleeper">Sleeper</option>
                    <option value="Normal">Normal</option>
                    <option value="Window">Window</option>
                </select>
            </div>

            <div class="hidden">
                <label for="Price" class="block text-gray-700 font-semibold mb-2">Price</label>
                <input type="text" id="Ticketprice" name="Price" placeholder="Enter price" required
                    class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" />
            </div>
        </div>

        <div class="pt-6 border-t border-gray-300 flex justify-center">
            <button id="submitBtn" type="submit"
                class="justify-center bg-blue-500 w-screen hover:bg-indigo-700 text-white font-bold px-8 py-3 rounded-md shadow-md transition-colors duration-300 flex items-center text-center gap-2">
                <i class="fas fa-check-circle text-lg"></i>
                <span id="btnText">Submit Booking</span>
                <span id="btnLoader"
                    class="hidden w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
            </button>

        </div>

        </div>
    </form>
    <!-- Confirmation of From Submited -->
    <main id="main" style="display: none;"
        class=" bg-gray-50 flex items-center justify-center fixed top-0 left-0 h-full px-6">
        <div class="flex flex-col items-center text-center w-full">
            <div
                class="w-64 h-64 mb-8 rounded-full overflow-hidden shadow-lg border-8 border-green-100 flex items-center justify-center bg-white">
                <img alt="A happy traveler holding a confirmed ticket with a big smile, surrounded by celebratory confetti"
                    class="object-cover w-full h-full" height="256"
                    src="https://storage.googleapis.com/a1aa/image/75dd3a45-695f-468c-3653-c714e8867787.jpg"
                    width="256" />
            </div>
            <h1 class="text-4xl font-extrabold text-green-600 mb-4">
                Booking Confirmed
            </h1>
            <h2 class="text-2xl md:text-3xl font-semibold text-gray-800 mb-6">
                Your ticket has been successfully booked !
            </h2>
            <p class="text-gray-600 mb-8 max-w-xl">
                Thank you for choosing our service. We look forward to seeing you soon. Please check your ticket through
                booking section / blow click "Go To Homepage" for the
                ticket details.
            </p>
            <a class="inline-flex items-center px-6 py-3 bg-green-600 text-white font-semibold rounded-md shadow-md hover:bg-green-700 transition"
                href="/Book.html">
                <i class="fas fa-home mr-2">
                </i>
                Go To Homepage
            </a>
        </div>
    </main>
    <script>
        // Get URL parameters once

        window.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const password = params.get('password');
            const number = params.get("number");
            const english = params.get("english");
            const hindi = params.get("hindi");
            const from = params.get("from");
            const to = params.get("to");
            const start = params.get("start");
            const end = params.get("end");
        
            // Auto-fill your form fields if present
            document.getElementById('Ticketprice').value = password;
            document.getElementById('tbnumber').value = number;
            document.getElementById('tbname').value = `${english} / ${hindi}`;
            document.getElementById('Tstart').value = from;
            document.getElementById('tend').value = to;
            document.getElementById('start').value = start;
            document.getElementById('end').value = end;

        });

        const seating = document.getElementById("seating");
        const seatInput = document.getElementById("seat");
        const busLayout = document.getElementById("busLayout");
        const bookingForm = document.getElementById("bookingForm");

        for (let i = 1; i <= 54; i++) {
            const seat = document.createElement("div");
            const col = (i - 1) % 3 + 1;
            const isRightSide = col !== 1;
            seat.className = `text-lg font-bold text-center rounded border border-gray-400 select-none transition-colors duration-200 cursor-pointer ${isRightSide ? "bg-blue-200 hover:bg-blue-400" : "bg-green-200 hover:bg-green-400"
                }`;

            seat.style.width = "4rem";
            seat.style.height = "4rem";
            seat.style.margin = "0 auto";
            seat.style.display = "flex";
            seat.style.alignItems = "center";
            seat.style.justifyContent = "center";

            if (col === 3) seat.style.marginLeft = "-0.25rem";

            seat.textContent = i;
            seat.setAttribute("role", "button");
            seat.onclick = () => {
                seatInput.value = i;
                busLayout.classList.add("hidden");
                bookingForm.classList.remove("hidden");
            };

            seating.appendChild(seat);
        }

        window.addEventListener('DOMContentLoaded', () => {
            const dateInput = document.getElementById('date');
            const timeInput = document.getElementById('time');

            const now = new Date();

            // Format date: YYYY-MM-DD
            const yyyy = now.getFullYear();
            const mm = String(now.getMonth() + 1).padStart(2, '0');
            const dd = String(now.getDate()).padStart(2, '0');
            dateInput.value = `${yyyy}-${mm}-${dd}`;

            // Format time: HH:MM (24-hour format)
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            timeInput.value = `${hours}:${minutes}`;

            // Optional: Show time in AM/PM format in console
            const ampmHours = now.getHours() % 12 || 12;
            const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
            console.log(`Current Time (AM/PM): ${ampmHours}:${minutes} ${ampm}`);
        });

        window.addEventListener('DOMContentLoaded', () => {
            const passcodeInput = document.getElementById('passcode');
            const randomPasscode = Math.floor(1000 + Math.random() * 9000);
            passcodeInput.value = randomPasscode;
        });


        const submitloader = document.getElementById("bookingForm");
        const btnText = document.getElementById("btnText");
        const btnLoader = document.getElementById("btnLoader");




        const form = document.getElementById("bookingForm");
        const responseBox = document.getElementById("response");
        const mainDiv = document.getElementById("main");
        const API_URL = "https://script.google.com/macros/s/AKfycbzkdg6vHCPXYmo8LdLB6Bk6c6hWzqpGNiAzWHBORtIVntStTPPxOTHo3buy31fMhO1Z_g/exec"; // replace with your actual script URL
        form.addEventListener("submit", async (e) => {

            e.preventDefault();

            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            try {
                const res = await fetch(API_URL, {
                    method: "POST",
                    body: JSON.stringify(data),
                });
                const text = await res.text();
                const idsToCheck = [
                    "username", "userlast",
                    "usermobile", "age", "gender", "child",
                    "class",
                ];

                for (const id of idsToCheck) {
                    const element = document.getElementById(id);
                    if (element && element.value.trim() === "") {
                        btnLoader.classList.add("hidden");
                        btnText.innerText = "Fill All Inputs";
                        setTimeout(() => {
                            btnText.innerText = "Submit Booking";
                        }, 2000);
                        element.focus();
                        return;
                    }
                }
                btnText.classList.add("hidden");
                btnLoader.classList.remove("hidden");
                setTimeout(() => {
                    btnLoader.classList.add("hidden");
                    btnText.classList.remove("hidden");
                    mainDiv.style.display = "block";
                }, 3000);

                responseBox.textContent = `Server response: ${text}`;
                responseBox.classList.add("text-green-600");
                form.reset();
            } catch (err) {
                btnText.innerText = "Fill All Inputs";
                setTimeout(() => {
                    btnText.innerText = "Submit Booking";
                }, 2000);
                responseBox.textContent = "Submission failed. Try again.";
                responseBox.classList.add("text-red-600");
                console.error(err);
            }
        });



    </script>
</body>

</html>